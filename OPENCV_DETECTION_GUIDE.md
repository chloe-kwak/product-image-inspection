# 🔍 OpenCV 테두리 탐지 가이드

## 개요

OpenCV 컴퓨터 비전 기술을 사용하여 상품 이미지의 배경 테두리를 자동으로 탐지합니다.

---

## 핵심 원리

### "액자 프레임만 검사"

이미지의 **최외곽 2.5%만 검사**하고, **중앙 95%는 무시**합니다.

```
┌───────────────────────────────┐
│ ▓▓ 검사 영역 (2.5%)    ▓▓       │
│ ▓▓                         ▓▓ │
│ ▓▓ ┌─────────────────────┐ ▓▓ │
│ ▓▓ │                     │ ▓▓ │
│ ▓▓ │   무시 영역 (95%)     │ ▓▓ │
│ ▓▓ │   (제품 영역)         │ ▓▓ │
│ ▓▓ │                     │ ▓▓ │
│ ▓▓ └─────────────────────┘ ▓▓ │
│ ▓▓                         ▓▓ │
└───────────────────────────────┘
```

**이유:**
- 테두리는 이미지 가장자리에만 존재
- 제품 자체의 색상/패턴은 검사 대상이 아님

---

## 검사 프로세스

### 1단계: 영역 설정
- ✅ **검사 영역**: 이미지 최외곽 2.5%
- ❌ **무시 영역**: 중앙 95% (제품 영역)

### 2단계: 색상 분석
9가지 색상 범위 검사:
- 파란색 (하늘색, 진파랑, 청록색)
- 빨간색 (빨강, 주황)
- 녹색, 노란색, 보라색 등

**판정 기준:**
| 색상 비율 | 판정 | 이유 |
|----------|------|------|
| 0 ~ 20% | 무시 | 너무 적음 (노이즈) |
| 20 ~ 95% | 테두리 | 정상 범위 |
| 95 ~ 100% | 무시 | 제품 자체 색상 |

### 3단계: 경계선 분석
Canny 엣지 검출 알고리즘으로 강한 경계선 확인
- **15% 이상**: 명확한 테두리 존재
- **15% 미만**: 자연스러운 배경

### 4단계: 최종 판정
```
신뢰도 = (색상 점수 × 50%) + (경계선 점수 × 50%)

if 신뢰도 > 15%:
    테두리 있음 → 반려
else:
    테두리 없음 → 통과
```

---

## 실제 예시

### ✅ 예시 1: 파란 테두리 이미지 (반려)
```
검사 결과:
- 색상: 파란색 60% 탐지 ✓ (20~95% 범위)
- 경계선: 25% ✓ (15% 이상)
- 신뢰도: 42.5%
- 판정: 반려 (테두리 있음)
```

### ✅ 예시 2: 파란 제품 (통과)
```
검사 결과:
- 색상: 파란색 100% 탐지 ✗ (95% 이상, 제품 색상)
- 경계선: 5% ✗ (15% 미만)
- 신뢰도: 0%
- 판정: 통과 (테두리 없음)
```

### ✅ 예시 3: 깔끔한 배경 (통과)
```
검사 결과:
- 색상: 특별한 색상 없음 ✗
- 경계선: 3% ✗ (15% 미만)
- 신뢰도: 0%
- 판정: 통과 (테두리 없음)
```

---

## 조정 가능한 설정

### 1. 중앙 제외 비율 (기본값: 95%)
```python
center_mask_ratio = 0.95  # 중앙 95% 제외
```
- **높일 경우**: 제품이 화면을 더 많이 차지하는 경우
- **낮출 경우**: 제품이 작고 배경이 많은 경우

### 2. 색상 범위 (기본값: 20~95%)
```python
if 0.20 < ratio < 0.95:  # 20~95% 범위
```
- **범위 좁히기**: 더 엄격한 테두리 판정
- **범위 넓히기**: 더 많은 테두리 탐지

### 3. 신뢰도 임계값 (기본값: 15%)
```python
has_border = confidence > 0.15  # 15% 임계값
```
- **높일 경우**: 오탐지 감소, 일부 테두리 놓칠 수 있음
- **낮출 경우**: 더 많은 테두리 탐지, 오탐지 증가 가능

---

## 기술 스택

- **OpenCV**: 컴퓨터 비전 라이브러리
- **HSV 색공간**: 색상 분석에 최적화
- **Canny 엣지 검출**: 경계선 탐지 알고리즘
- **NumPy**: 고속 이미지 처리

---

## 장점

✅ **빠른 속도**: 이미지당 0.1초 미만  
✅ **높은 정확도**: 제품 색상과 테두리 구분  
✅ **무료**: 추가 비용 없음 (오픈소스)  
✅ **오프라인 가능**: 인터넷 연결 불필요  

---

## 제한사항

⚠️ **매우 얇은 테두리**: 1-2px 테두리는 탐지 어려움  
⚠️ **그라데이션 테두리**: 점진적 색상 변화는 탐지 어려움  
⚠️ **복잡한 패턴**: 체크무늬 등 복잡한 배경은 오탐지 가능  

→ 이런 경우 2단계 AI 검수로 보완

---

## 문의

기술 지원이 필요하시면 연락주세요.
